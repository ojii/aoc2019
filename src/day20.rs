use crate::render::render;
use itertools::Itertools;
use pathfinding::prelude::*;
use std::cmp::Ordering;
use std::collections::HashMap;
use std::fmt::{Display, Error, Formatter};
use std::iter::FromIterator;

enum RawTile {
    Empty,
    Wall,
    Passage,
    Letter(char),
}

impl From<char> for RawTile {
    fn from(c: char) -> Self {
        match c {
            ' ' => Self::Empty,
            '#' => Self::Wall,
            '.' => Self::Passage,
            c if c.is_ascii_uppercase() => Self::Letter(c),
            c => panic!("unexpected tile {}", c),
        }
    }
}

#[derive(Debug)]
enum Tile {
    Empty,
    Wall,
    Passage,
    Start,
    End,
    Portal([char; 2]),
}

impl Tile {
    fn portal(&self) -> Option<[char; 2]> {
        match self {
            Tile::Portal(name) => Some(*name),
            _ => None,
        }
    }
}

impl Display for Tile {
    fn fmt(&self, f: &mut Formatter<'_>) -> Result<(), Error> {
        match self {
            Tile::Empty => f.write_str("　"),
            Tile::Wall => f.write_str("＃"),
            Tile::Passage => f.write_str("・"),
            Tile::Portal(v) => write!(f, "{}{}", v[0], v[1]),
            Tile::Start => f.write_str("初"),
            Tile::End => f.write_str("終"),
        }
    }
}

type Name = [char; 2];
type Coords = (usize, usize);
type Grid = HashMap<Coords, RawTile>;
type Maze = HashMap<Coords, Tile>;
type Portals = HashMap<Name, [Coords; 2]>;

const NEIGHBORS: [fn(usize, usize) -> Option<Coords>; 4] = [
    |x, y| x.checked_sub(1).map(|x| (x, y)),
    |x, y| x.checked_add(1).map(|x| (x, y)),
    |x, y| y.checked_sub(1).map(|y| (x, y)),
    |x, y| y.checked_add(1).map(|y| (x, y)),
];

fn detect_portal(x: usize, y: usize, c: char, grid: &Grid) -> Tile {
    let (other, open) = NEIGHBORS
        .iter()
        .flat_map(|f| f(x, y))
        .flat_map(|k| grid.get(&k))
        .fold((None, false), |(other, open), raw_tile| match raw_tile {
            RawTile::Passage => (other, true),
            RawTile::Letter(c) => (Some(c), open),
            _ => (other, open),
        });
    if open {
        other
            .map(|&d| {
                if c == 'A' && d == 'A' {
                    Tile::Start
                } else if c == 'Z' && d == 'Z' {
                    Tile::End
                } else {
                    Tile::Portal(match c.cmp(&d) {
                        Ordering::Less | Ordering::Equal => [c, d],
                        Ordering::Greater => [d, c],
                    })
                }
            })
            .unwrap_or(Tile::Empty)
    } else {
        Tile::Empty
    }
}

fn grid2maze(grid: Grid) -> Maze {
    Maze::from_iter(grid.iter().map(|(key, raw)| {
        (
            *key,
            match raw {
                RawTile::Empty => Tile::Empty,
                RawTile::Passage => Tile::Passage,
                RawTile::Wall => Tile::Wall,
                RawTile::Letter(c) => detect_portal(key.0, key.1, *c, &grid),
            },
        )
    }))
}

fn connect_portals(maze: &Maze) -> Portals {
    let mut tmp: HashMap<Name, Vec<Coords>> = HashMap::new();
    for (coords, portal) in maze
        .iter()
        .filter_map(|(coords, t)| t.portal().map(|name| (coords, name)))
    {
        (*tmp.entry(portal).or_default()).push(*coords);
    }
    let mut portals = Portals::with_capacity(tmp.len());
    for (name, coords) in tmp {
        portals.insert(name, [coords[0], coords[1]]);
    }
    portals
}

fn get_exit(coords: &Coords, name: &Name, maze: &Maze, portals: &Portals) -> Option<Coords> {
    portals.get(name).and_then(|[start, end]| {
        let other = if coords == start { end } else { start };
        successors(other, maze, portals).first().cloned()
    })
}

fn successors(coords: &Coords, maze: &Maze, portals: &Portals) -> Vec<Coords> {
    NEIGHBORS
        .iter()
        .flat_map(|f| f(coords.0, coords.1))
        .flat_map(|c| {
            maze.get(&c).and_then(|t| match t {
                Tile::Passage | Tile::Start | Tile::End => Some(c),
                Tile::Portal(name) => get_exit(&c, name, maze, portals),
                Tile::Empty | Tile::Wall => None,
            })
        })
        .collect()
}

pub fn main() {
    let grid: HashMap<(usize, usize), RawTile> =
        HashMap::from_iter(INPUT.lines().enumerate().flat_map(|(y, line)| {
            line.chars()
                .enumerate()
                .map(move |(x, c)| ((x, y), c.into()))
        }));
    let maze = grid2maze(grid);
    let portals = connect_portals(&maze);
    let start = maze
        .iter()
        .find_map(|(c, t)| match t {
            Tile::Start => Some(c),
            _ => None,
        })
        .unwrap();
    let end = maze
        .iter()
        .find_map(|(c, t)| match t {
            Tile::End => Some(c),
            _ => None,
        })
        .unwrap();
    let path = bfs(
        start,
        |coords| successors(coords, &maze, &portals),
        |coords| coords == end,
    )
    .unwrap();
    let path: Vec<Coords> = path
        .clone()
        .into_iter()
        .skip(1)
        .take(path.len() - 2)
        .collect();
    println!(
        "{}",
        render(
            maze.iter()
                .map(|(&(x, y), t)| ((x as i64, y as i64), t.to_string()))
                .chain(
                    path.clone()
                        .into_iter()
                        .map(|(x, y)| ((x as i64, y as i64), "道".to_string()))
                ),
            "　".to_string(),
        )
    );
    println!("{}", path.len() - 1);
}

const INPUT: &str = "                                             T       M           S       R     H     F                                                 
                                             J       K           S       Y     D     P                                                 
  ###########################################.#######.###########.#######.#####.#####.###############################################  
  #.......#...#...#...........#...#.....#.#.......#...........#.....#.......#...#.................#.#...#...#...#...#...#.......#...#  
  #######.###.#.#######.###.#.#.#####.###.#####.#########.#####.#.###.#######.#.###.###.#.#.#######.#.###.###.#.#.###.#.#######.#.###  
  #...#.....#...#.#.#.#.#.#.#.#.....#...#.#.....#...........#...#.#.....#.....#.#.#.#.#.#.#...#.............#.#.......#.#.....#...#.#  
  #.#####.###.#.#.#.#.###.###.###.###.###.#.###.#####.###.#.###.#.#####.#.###.###.#.#.#####.###.#.###.#####.###.#.#.#.#######.#.###.#  
  #.....#.....#.#...#...#.....................#.#.....#.#.#.#.#.#...#...#.#...#...#.......#...#.#.#.#.#...#.#...#.#.#.#.............#  
  ###.#####.###.#.###.###.###.#.###.#######.###.#.#.###.#####.#.#####.#.###.###.#.#.#.###########.#.###.###.#.#######.#####.#######.#  
  #.....#...#.............#.#.#.#.#.#...#.#...#.#.#.....#.#.......#...#.#...#...#.#.#.........#.....#...#.......#...#.#...#.#.#...#.#  
  #####.#########.#.###.#.#.#.#.#.#.###.#.#.#######.###.#.#####.#####.#####.#.###.#.#####.###.###.#.###.###.#.###.#####.#####.###.#.#  
  #...#...#.#.....#.#...#...#.#.#.....#.......#...#...#...#.#.#...#.....#.......#.#.....#.#...#.#.#.......#.#.......#.#.#.....#.#...#  
  ###.#.###.#.###.###.#.###.#.#.#.###.###.#.###.###.#####.#.#.###.#.#############.#.###.#######.#.###.#####.###.#.#.#.#.#####.#.###.#  
  #.....#...#.#...#...#...#.#.#.#...#.#.#.#.......#.#.......#.#.#.#...#.#...#...#.#...#.#.#.#.#.....#.#...#.#...#.#.....#.#.......#.#  
  #####.#.###########.#################.###.#.###.###.###.#.#.#.#.#.###.###.#.#.#.#.#####.#.#.#.#######.###########.#####.###.###.#.#  
  #.#.#...#.#...#.........#.......#.#.......#.#.#.#.#...#.#.#.....#...#.#.....#...#.........................#.....#.....#...#.#.....#  
  #.#.#.###.###.#######.#.#######.#.#.###.#.###.###.#####.###.#.#.#.###.###.#.###.#.###.###.#.###.#####.#.#.###.#####.#####.#######.#  
  #.#...#.#...#...#.#.#.#.#.#...........#.#...#.....#.#...#.#.#.#.#...#.....#...#.#.#.#...#.#...#...#.#.#.#.#.....#.#.#.#.....#...#.#  
  #.###.#.###.###.#.#.#####.#.#######.#######.#.#####.###.#.#####.#.#####.#.#######.#.#######.#####.#.###.#.#.#####.###.###.#####.#.#  
  #.....#...#.........#.#.....#.......#.#.......#...#...#.....#...#...#.#.#.....#.....#...#.#...#.#.....#.#.#.#...#.......#...#.#...#  
  ###.###.#######.#.###.#.#.#####.#.###.###.#.#.#.#####.#.#######.#.###.###.###.#.###.###.#.#####.#.#.###.###.#.###.#######.###.###.#  
  #.....#.#.#...#.#.#...#.#.#.#.#.#.#.......#.#...#.#.....#.......#...#.....#...#.#...#.....#.#...#.#.#.#.#...#.#.#.#...#.#.....#.#.#  
  ###.###.#.#.###.#####.#####.#.#######.#.#.#.###.#.###.#.#.###.#.#.#######.#########.#.#.###.#.#######.#####.#.#.#.#.###.#.#####.#.#  
  #...#.......#.#.#...#...#.....#.......#.#.#.#...#...#.#.#.#...#.#.......#.#.#.#.#.#...#.#.........#.....#...........#.#...#...#.#.#  
  ###.#####.###.#.#.#####.#####.#.#.#######.###.###.#####.#####.###.###.###.#.#.#.#.#####.#.###.#######.#.#.###.#.#.###.###.###.#.#.#  
  #.....#...#...#...#...#.#.....#.#.#...#...#.#.#.....#...#...#...#.#.#.#.........#.........#.......#.#.#.#...#.#.#...#...#.#...#...#  
  ###.#####.#.###.###.###.###.#.###.###.###.#.###.#.#.#.###.#.#.###.#.###########.#.#######.#####.###.#.#########.#####.###.###.#.#.#  
  #...#.........#...#...#.#...#...#...#.#.....#.#.#.#.....#.#.....#.......#.....#.#.....#.......#.........#.#.........#.......#.#.#.#  
  ###.###.###.###.#.###.#.###.#.#######.#####.#.###.#######.#####.###.#.###.###.#.###.###.#.###.###.#######.#.###.#.#####.###.#.###.#  
  #.......#.#.#...#.#...#.#.#.#.#.....#.#.....#.......#...#.....#.#...#.#.....#...#.#...#.#...#...#.#.#...#.#.#...#...#...#.#.#.#...#  
  #######.#.#####.#####.#.#.###.###.###.###.#########.#.#.#.###.###.#########.###.#.#.#####.#########.###.#.#####.#######.#.###.###.#  
  #...#.....#...#...#.#...#.#...#.....#.....#.....#...#.#.#.#...#...#.#...#.....#.#.....#.#...#.#.......#...#.#.......#.....#.#...#.#  
  #.#######.#.###.###.#.###.###.###.###.###.#.#.###.###.#.#.#.###.#.#.#.###.#######.#####.###.#.#####.###.###.###.#####.###.#.#.###.#  
  #...#.........#.....#.....#.....#.#...#.....#...#.....#.#.#...#.#.....#.........#.#.....#.......#.....#.#.#...#...#.#...#.#...#...#  
  ###.#.#.#######.#####.#########.#.#############.###.###.###.#.###.###.#.#######.#.#.###.#########.#####.#.#.#####.#.#####.###.###.#  
  #.#.#.#.#...#...#...#.#.#...#.....#...............#.#...#...#.#.....#.#.#.......#...#.......#.....#.#.#.....#.......#.....#.#.#...#  
  #.#.###.###.###.###.#.#.###.###.#########.###########.#####.#######.#####.###########.###########.#.#.#.###.###.#.#######.#.#.#.###  
  #.......#.........#.....#.#...#.#.#      G           R     H       J     N           E          #.#...#.#.#.#.#.#.#.#.....#.#.#...#  
  ###.#.#########.#######.#.#.###.#.#      Y           Y     D       S     Z           S          #.###.###.#.#.#.###.#####.#.#.#.###  
  #...#.#...#.#.#.#...#.#.#.#...#...#                                                             #.......#.......#...#.#............ES
  #####.###.#.#.#.###.#.#.#.###.#.###                                                             #.#####.#.###.#####.#.###.#######.#  
  #.#...................#.#.......#.#                                                             #...#.#...#.....#.#.#...........#.#  
  #.###.#######.#######.#.#.###.###.#                                                             ###.#.#####.#.###.#.#####.#.#.#.###  
  #...#.....#.........#.......#......YL                                                         XA..#.....#...#...#...#.#...#.#.#.#.#  
  #.#####.#####.#.#.#######.#.#.#.###                                                             #.#####.#.#######.###.#####.#.###.#  
JW....#.....#...#.#.....#.#.#.#.#...#                                                             #.......#...................#.#.#.#  
  #.###.###########.#.###.#######.###                                                             #####.###.#.#.#################.#.#  
  #.....#.....#.#...#.#.......#.....#                                                           GU..#.....#.#.#.#...#.......#.......#  
  #.###.###.###.###########.#.#######                                                             #.###############.#####.###.###.#.#  
  #...#.#.......#.#.#.#...#.#...#....JW                                                           #.......#.#.#...#.#.#.#...#...#.#..HK
  #.#####.#######.#.#.#.#####.###.#.#                                                             #.#######.#.#.###.#.#.#.#.#.#.#####  
  #.#.#...#...#.......#.#.#.#.....#.#                                                             #.......................#...#.#.#.#  
  ###.###.###.#####.###.#.#.#.#.#.###                                                             ###############################.#.#  
YF....#.....#.....#.....#...#.#.#...#                                                             #.........#.........#.......#......YU
  #.###.###.#.###.#.#.#####.#######.#                                                             #.###.#.#.###.#####.#.#.#.#.###.#.#  
AA......#.....#.#...#...............#                                                             #.#.#.#.#.#...#.#.....#.#.#.....#.#  
  #.###.###.#.#.###.###########.#####                                                             #.#.#####.###.#.#.#.###.#####.#####  
  #...#...#.#.#.#.....#.......#.#...#                                                           MG........#.......#.#...#...#.....#.#  
  #.###.#######.#######.#####.###.#.#                                                             ###.#.#######.#####.###.###.#####.#  
  #...#...#.#.#.....#.......#.#.#.#..NS                                                           #.#.#.#...#.......#.#.#...#.#.#.#..OP
  #########.#.#.#.#########.#.#.#.###                                                             #.###.#.#######.###.#.#####.#.#.#.#  
  #.....#.#.....#...#...#...#...#...#                                                             #.#...#.....#.....#.#...#.#.#......GU
  ###.###.#.###.#.#.#.#.#.#####.###.#                                                             #.#####.#.#############.#.###.###.#  
NK..........#...#.#...#.....#.#.....#                                                           YU....#...#.#...#.#.#.#.....#.....#.#  
  ###########################.#####.#                                                             #.#####.#.###.#.#.#.###.#.###.###.#  
  #...................#.......#.#.#.#                                                           SS........#...............#.......#.#  
  ###.###.#######.#.#.###.#.###.#.###                                                             #########.#########################  
  #...#.#.#.......#.#...#.#.........#                                                             #.......#.#.......#...#...#...#...#  
  #.###.#####.#.###.#.###.###.###.###                                                             #.#####.###.###.#.#.#.#.###.#.#.###  
NZ..#...#...#.#...#.#.#.....#.#...#..OK                                                         MK....#...#.#.#...#...#...#...#...#..CK
  ###.###.#####.#####.#.#.#.###.###.#                                                             #####.###.#.#####.###.###.#####.#.#  
  #.....#.#...#.#.#.....#.#.#.......#                                                             #.#.............#.#.#.#.....#.....#  
  ###.###.#.#####.###.#######.#.#.#.#                                                             #.#.#.#####.#####.#.#.#####.#####.#  
  #...........#.#.....#.....#.#.#.#.#                                                             #...#.#.....#.#...#.#.......#.#.#.#  
  #.###.###.###.###.#####.#.#########                                                             #############.#####.#########.#.###  
  #...#.#.#.......#.#.#...#.....#...#                                                             #...........................#.#....NS
  ###.#.#.#.#########.###.###.#.#.#.#                                                             #.###.#.###.#.#######.#####.#.#.###  
YL..#.#...#.#.#.#.#...#.#...#.#...#..OP                                                           #...#.#.#.#.#...#.....#.#.........#  
  #.#.#.#####.#.#.#.###.###.#.#.###.#                                                             #.#.#####.#.###########.#######.###  
  #...#.....................#.#.#.#.#                                                           HK..#.#.#...#.#...#...#.#.#.......#.#  
  ###########.###.###.###########.###                                                             #####.#.#####.###.###.#.#########.#  
  #.#...#...#.#.....#...#...#.....#.#                                                           FP..#.#.#...#.#...#...........#.#....CD
  #.###.#.#.#########.###.#.#.#.#.#.#                                                             #.#.#.#.#.#.###.#.#.#.#.#####.#.###  
  #.......#...#...#.#.#...#.#.#.#...#                                                             #.....#.#.....#...#.#.#.#.........#  
  #.#######.###.###.###.#.#.#.###.###                                                             #####.#.#####.#.#######.#.#.#####.#  
  #...#.......#...#.#...#.#...#......FK                                                           #.#...#...#...#.#.#.#...#.#.#.#...#  
  #.###.#######.###.#####.###.###.###                                                             #.#.#####.#.###.#.#.###.#####.#.###  
OE....#.....................#...#...#                                                             #.........#.........#.............#  
  #.#####.###.###.#.#.###.#.#.###.###      C       C       I         O       N       Y       T    ###.###.#.###.#.#.#.#.#.#.#####.###  
  #...#...#.....#.#.#...#.#.#.#...#.#      K       D       J         E       K       F       J    #...#...#...#.#.#.#.#.#.#...#...#.#  
  #.#####.###.#.#.#.#.###.###.#####.#######.#######.#######.#########.#######.#######.#######.#####.###.###.###.#########.#########.#  
  #.#.#.....#.#.#.#.#.#.....#...#.......#.#...#.....#.......#.#...#...#...........#...#.....#...#.....#...#.#.......#...............#  
  #.#.#.#.#.#######.###.#.###.#.#####.###.###.###.#####.#####.#.#.#.#.###.#.#.#.###.#####.#.#.#.###.#.#.###.###.#####.#.###.###.#.#.#  
  #.#...#.#...#.#...#...#.#...#.#.#.........#.#.......#.#...#.#.#...#.#...#.#.#.#.....#...#...#...#.#.#.#...#.......#.#.#.#.#...#.#.#  
  ###.###.#.###.###.#.#.#####.###.#####.###.#.#.###.#.#.#.#.#.###.#.#.#.###.#########.###.#####.###.#####.#######.###.###.#.#######.#  
  #...#.#.#...#...#.#.#.#.#.......#...#...#...#.#...#.#...#...#...#.#.#...#...#.....#.#.....#.....#.#.#.#...#.......#.#.........#...#  
  #.#.#.#.#####.###.###.#.###.#.#####.###.#####.#.###########.###.#####.#.#######.#.#.#.###.#########.#.#.#.#####.#####.###.#.#.###.#  
  #.#...#.#.....#.....#...#...#.#.............#.#.......#...#...#...#.#.#.....#...#.#.#.#.........#.....#.#.#...#...#...#.#.#.#...#.#  
  #.###.#.#.#.#####.###.#.#########.###.#.#####.#########.###.###.###.#####.###.###.#.###.###.###.#.#####.###.###.#####.#.###.#.###.#  
  #.#...#...#.#.#.....#.#...#.......#...#...#.....#...#.......#...#...........#...#.....#.#...#.#...#...#.#...#.....#...#.#...#.#.#.#  
  #.###.#.#.###.#######.#.#.#####.#####.#####.#.###.#.#####.###.#.#####.#########.###.#####.###.#.###.#####.###########.#.###.###.###  
  #.#...#.#.........#...#.#.....#.#.#.#.#...#.#.....#.#...#...#.#.#.......#.......#.....#.#...#.#.#.#.#.#...#.#.#.#.#...#...........#  
  ###.#####.###.###.#####.#########.#.#.#.#######.#####.###.###.#######.#####.#.#########.###.#.###.#.#.#.###.#.#.#.#######.#.#.#####  
  #...#.......#.#.#.#...#.#.#...............#.........#.#.#...#.......#.#...#.#.......#...#.......#.#...................#...#.#...#.#  
  ###.#####.#.###.#####.###.#####.#.#.###.#.###.###.#.#.#.#.#.#######.#.#.#.#########.#.#####.#####.#.#########.###.#####.#.#.#.#.#.#  
  #.#...#.#.#...#...#.............#.#.#...#...#.#.#.#.#.....#...#.....#...#.......#.....#...#.#.#.........#...#.#.#.#.....#.#.#.#...#  
  #.#.#.#.#.#.#####.###.###.#.#############.###.#.#####.#############.###.#.#.#.###.#######.#.#.###.#######.#####.#####.#####.#####.#  
  #...#.#...#.#...#.#...#.#.#.#...#.#...#.#.#.#.#.#...#...#.#.#.#.#.....#.#.#.#.#.......#.#.....#.#.#.......#.#.....#.....#.......#.#  
  ###.#####.###.#.#.#####.#####.#.#.#.#.#.#.#.#.###.#.#.###.#.#.#.#.#####.###.#####.#.#.#.###.###.#.#.#####.#.#####.#########.#.#.###  
  #.....#...#.#.#.........#...#.#.....#.......#.#...#.#.#.#...........#.#.#...#.#...#.#.#.#.#...........#...................#.#.#...#  
  ###.###.#.#.#####.#.###.###.#######.###.###.#.###.#.#.#.#####.#######.#.#.###.#####.###.#.#.#####.#.#.#######.###.#####.#####.#.###  
  #.....#.#.....#...#...#...#.#.#.#.....#.#...#.....#.#...#.#.#.#.....#.#.#.#.....#...#.........#.#.#.#...#...#...#...#...#.....#...#  
  ###.###.#.#.#.#####.###.###.#.#.#######.###.#.#####.#.###.#.#.###.#.#.###.###.#####.#####.###.#.#.#######.#######.###.#.###.#.#.###  
  #.#.#...#.#.#.#.....#.#...#...#.#.#...#...#.#.#.....#.....#.......#...#.........#...#...#...#...#...#...........#.#.#.#.#.#.#.#...#  
  #.#.#####.###.#######.###.###.#.#.###.#####.###.#####.#########.###.#.#####.#.#####.#.#.#.###.#######.#######.###.#.###.#.#.#.#.#.#  
  #.......#...#.#.#.#.............#...#.#.#...#.......#.......#.....#.#.....#.#.#.#...#.#.....#...#.#.#.#.....#...#.#...#.#.#.#.#.#.#  
  ###.#.###.###.#.#.#.#####.###.#.###.#.#.###.#.#####.#####.###.###.#.###.###.###.#.#.#.#####.#####.#.#.#.###.#####.#.#####.#########  
  #.#.#.#...#.......#.#.....#...#.............#.#.....#.....#.#.#.#.#.#.#.#.#.#...#.#.#...#.................#.....#.#.......#.#.#...#  
  #.#.#######.###.#####.#.#.#.###.#####.#.#########.###.#####.###.###.#.###.#.###.###.###.###.#.#######.#.###.#######.#.###.#.#.#.#.#  
  #.....#.......#...#.#.#.#.#...#.#.....#.#.......#.#.......#.#.........#.#...#.......#...#.#.#.#.#.#...#...#.........#.#.........#.#  
  #.###.#####.###.###.###.#.#.###.#.#.#.###.#.#.#.#.#######.#.###.#.#.###.###.#.#######.###.#####.#.#.#.#######.###.#####.#.#.#######  
  #...#.#.......#.#.#.....#.#.#...#.#.#.#...#.#.#...#...#.#...#...#.#.#.#.....#.......#.#...........#.#.....#.#.#.......#.#.#.#.#...#  
  #.#.#.###.#######.###.#.#####.#.#.###.#######.#######.#.###.#.#######.###.#.#######.#.###.#.###.#.###.#####.#####.#.#####.###.#.###  
  #.#.#...#.#...........#...#...#.#.#.......#...........#.....#.........#...#.....#...#.....#...#.#.#...........#...#.....#.........#  
  #####################################.#############.#####.###.###.#########.#####.#######.#########################################  
                                       M             F     J   I   Z         G     O       X                                           
                                       G             K     S   J   Z         Y     K       A                                           ";
